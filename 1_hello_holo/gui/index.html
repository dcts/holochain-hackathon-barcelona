<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Hello GUI</title>
    <meta name="description" content="GUI for a Holochain app" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.min.css"/>
  </head>

  <body>
    <h1>Holochain GUI</h1>
    <div class="flex">
      <div class="left-section">
        <h2>Whats your name?</h2>
        <input id="name-input" type="text" name="fname">
        <button type="button" onclick="makeHttpRequest();">Say Hello</button>
        <h2>Generate Random Number</h2>
        <button type="button" onclick="makeHttpRequest();">Generate</button>
        <h2>Play Cointoss</h2>
        <input id="name-input" type="text" name="fname">
        <button type="button" onclick="makeHttpRequest();">Play</button>
      </div>
      <div class="right-section">
        <div class="result">
          <h2>Response Log</h2>
          <p class="inject-result"></p>
        </div>
      </div>
    </div>
  </body>
</html>

<style>
  .right-section,
  .left-section {
    min-width: 200px;
  }
  .right-section {
    padding: 10px 30px;
    border-radius: 6px;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
    margin-left: 60px;
    background-color: rgba(255,255,255,0.1);
    overflow: hidden;
    max-height: 450px;
  }
  .flex {
    display: flex;
    justify-content: start;
  }
</style>

<script>
  const makeHttpRequest = () => {
    // grab your name
    const input = document.getElementById("name-input");
    const name = input.value;
    input.value = "";
    // create http request
    const xhr = new XMLHttpRequest();
    // response handling
    xhr.onload = function () {
      const responseString = JSON.parse(JSON.parse(this.responseText).result).Ok;
      const html = `<p style="line-height:12px; font-size:12px;">${responseString}</p>`;
      document.querySelector(".inject-result").insertAdjacentHTML("afterbegin", html);
    };
    // data to send (HOLOCHAIN SPECIFICATION)
    const toSend = {
      "id": "0",
      "jsonrpc": "2.0",
      "method": "call",
      "params": {
        "instance_id": "test-instance",
        "zome": "hello",
        "function": "hello_holo",
        "args": {
          "name": name
        }
      }
    };
    xhr.open("POST", "http://127.0.0.1:8888"); // holochain server needs to be up and running
    xhr.setRequestHeader("Content-type", "application/json");
    xhr.send(JSON.stringify(toSend));
  };
</script>

